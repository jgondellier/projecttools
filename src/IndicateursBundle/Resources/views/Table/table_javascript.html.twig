<script type="text/javascript">
    function getTable{{ table.id }}(){
        $.fn.dataTable.moment( 'MMMM','fr' );
        $('#{{ table.id }}').DataTable( {
            "ajax":{
                "url": "{{ table.ajax.url }}",
                {% if(table.ajax.datas is defined) %}
                "data": {
                    {% for data in table.ajax.datas %}
                    "{{ data.name }}": "{{ data.value }}",
                    {% endfor %}
                },
                {% endif %}
            },
            "columns": [
                {% for col in table.cols %}
                { "data": "{{ col.data }}"{% if(col.href is defined) %},
                    "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                        $(nTd).html("<a href='{{ col.href }}"+oData.{{ col.data }}+"' target='_blank'>"+oData.{{ col.data }}+"</a>");
                    }
                    {% elseif ((col.convert is defined)) %},
                    "fnCreatedCell": function (nTd, sData, oData, iRow, iCol) {
                        $(nTd).html(Math.round(oData.{{ col.data }}/60)+" heures");
                    }
                    {% elseif ((col.edit is defined)) %},
                    "defaultContent": "<button type=\"button\" class=\"btn btn-primary btn-sm edit-row\"><span class=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\"></span> Modifier</button>"
                    {% elseif ((col.del is defined)) %},
                    "defaultContent": "<button type=\"button\" class=\"btn btn-danger btn-sm del-row\" ><span class=\"glyphicon glyphicon-remove\" aria-hidden=\"true\"></span> Supprimer</button>"
                    {% endif %} },
                {% endfor %}
            ],

            {% for col in table.cols %}
            {% if (col.edit is defined) or (col.del is defined) %}
            "columnDefs": [ {
                "searchable": false,
                "orderable": false,
                "targets": -1
            },{
                "searchable": false,
                "orderable": false,
                "targets": -2
            }
            ],
            {% endif %}
        {% endfor %}
            "scrollY":        "350px",
            "scrollCollapse": true,
            "paging":         false,
            "dom": 'Bfrtip',
            "buttons": [
                'excel', 'pdf', 'print'
            ],
            initComplete: function () {
                this.api().columns('.select-filter').every( function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                            .appendTo( $(column.footer()).empty() )
                            .on( 'change', function () {
                                var val = $.fn.dataTable.util.escapeRegex(
                                        $(this).val()
                                );
                                column
                                        .search( val ? '^'+val+'$' : '', true, false )
                                        .draw();
                                var title = column.header();
                                {% if(graph is defined) %}
                                var table = $('#{{ table.id }}').DataTable();
                                var datas = {};
                                $('#{{ table.id }}_wrapper .dataTables_scrollFoot select').each(function( index ) {
                                    var columnHeader = table.column( index ).header();
                                    datas[columnHeader.id] = $( this ).val();
                                });
                                if (typeof getGraph{{ graph.id }} === "function") {
                                    getGraph{{ graph.id }}(datas);
                                }
                                {% endif %}
                            } );
                    column.data().unique().sort().each( function ( d, j ) {
                        select.append( '<option value="'+d+'">'+d+'</option>' )
                    } );
                } );
            }
        } );
    }
    addLoadEvent(getTable{{ table.id }});
</script>